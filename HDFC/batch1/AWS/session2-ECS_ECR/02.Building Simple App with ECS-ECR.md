
## ğŸ§© Building & Deploying Containers with **ECR + ECS**

**Goal:** Deploy a simple Node.js backend to AWS ECS using a container image stored in ECR.
**Duration:** ~2 hours (demo + explanation)

---

## ğŸ”¹ 1. Recap â€” Containers & Docker

Before starting, quickly revisit these:

* **Containers** package code + dependencies â†’ run identically everywhere.
* **Docker** is the most popular containerization tool.
* You write a `Dockerfile` â†’ build image â†’ run container.
* **ECR** (Elastic Container Registry): AWSâ€™s private Docker image store.
* **ECS** (Elastic Container Service): AWSâ€™s container orchestration service to run and scale containers.

---

## ğŸ”¹ 2. Create a Simple Node.js Backend App

### ğŸ“ Folder: `aws-node-demo`

```bash
mkdir aws-node-demo
cd aws-node-demo
npm init -y
npm install express
```

### ğŸ“„ server.js

```js
const express = require("express");
const app = express();
const PORT = process.env.PORT || 3000;

app.get("/", (req, res) => {
  res.send("ğŸš€ Hello from AWS ECS!");
});

app.listen(PORT, () => console.log(`Server running on port ${PORT}`));
```

Test locally:

```bash
node server.js
# visit http://localhost:3000
```

---

## ğŸ”¹ 3. Create a Dockerfile

### ğŸ“„ Dockerfile

```Dockerfile
# Step 1: Base image
FROM node:18-alpine

# Step 2: Set working directory
WORKDIR /app

# Step 3: Copy package.json and install deps
COPY package*.json ./
RUN npm install --production

# Step 4: Copy rest of app
COPY . .

# Step 5: Expose port and start app
EXPOSE 3000
CMD ["node", "server.js"]
```

Build and test locally:

```bash
docker build -t node-aws-demo .
docker run -p 3000:3000 node-aws-demo
```

âœ… Test: visit [http://localhost:3000](http://localhost:3000) â€” you should see the message.

---

## ğŸ”¹ 4. Push Image to **Amazon ECR**

### ğŸ§­ Step-by-step (AWS Console + CLI)

1. **Login to AWS Console** â†’ open **ECR**.

2. Click **Create Repository**

   * Name: `node-aws-demo`
   * Visibility: *Private*
   * Create.

3. Once created â†’ click repository â†’ click **View push commands** (top-right).

4. Follow those exact commands (AWS gives them customized for your region):

```bash
# 1. Authenticate Docker to AWS
aws ecr get-login-password --region ap-south-1 | docker login --username AWS --password-stdin <your-account-id>.dkr.ecr.ap-south-1.amazonaws.com

# 2. Tag your local image
docker tag node-aws-demo:latest <your-account-id>.dkr.ecr.ap-south-1.amazonaws.com/node-aws-demo:latest

# 3. Push to ECR
docker push <your-account-id>.dkr.ecr.ap-south-1.amazonaws.com/node-aws-demo:latest
```

âœ… Verify in AWS Console â†’ ECR â†’ your image should appear under *Tags*.

---

## ğŸ”¹ 5. Understanding ECS

**ECS** = Elastic Container Service â†’ runs your containers in the cloud.

Key components:

| Concept             | Description                                                            |
| ------------------- | ---------------------------------------------------------------------- |
| **Cluster**         | Group of resources (EC2 or Fargate) where tasks run                    |
| **Task Definition** | Blueprint of container (image, CPU, memory, ports, env vars)           |
| **Service**         | Ensures that tasks (containers) keep running, can scale, restart, etc. |

---

## ğŸ”¹ 6. Create ECS Cluster

### Option A: Fargate (Serverless, Recommended)

No EC2 management needed â€” AWS handles servers for you.

1. Go to **ECS â†’ Clusters â†’ Create Cluster**

   * Choose: **Networking only (Fargate)**
   * Name: `node-demo-cluster`
   * Create.

---

## ğŸ”¹ 7. Create Task Definition

1. Go to **ECS â†’ Task Definitions â†’ Create new Task Definition**

   * Launch type: **Fargate**
   * Task name: `node-demo-task`
   * OS: Linux
   * CPU: 256
   * Memory: 512

2. Add container:

   * Name: `node-container`
   * Image: `<your-account-id>.dkr.ecr.ap-south-1.amazonaws.com/node-aws-demo:latest`
   * Port mappings: **3000**
   * Click â€œAddâ€.

3. Click **Create**.

---

## ğŸ”¹ 8. Create Service (to run the container)

1. Go to **ECS â†’ Clusters â†’ node-demo-cluster â†’ Services â†’ Create**

   * Launch type: Fargate
   * Task Definition: `node-demo-task`
   * Service name: `node-demo-service`
   * Desired tasks: 1

2. Networking:

   * Choose **default VPC**
   * Choose **public subnets**
   * Assign **public IP = ENABLED**
   * Create new security group â†’ allow **Inbound HTTP (port 3000)**

3. Click **Create Service** â†’ wait until service status is *Running*.

---

## ğŸ”¹ 9. Verify Deployment

1. Go to **Tasks â†’ Running task â†’ Network tab**
   Copy the **Public IP**.

2. Visit in browser:

```
http://<public-ip>:3000
```

âœ… You should see â€œğŸš€ Hello from AWS ECS!â€

---

## ğŸ”¹ 10. (Optional) Expose via Load Balancer

If you want a production-grade setup:

* In ECS service creation step, choose â€œApplication Load Balancerâ€.
* Create new ALB â†’ target group â†’ register ECS tasks.
* Access app via ALB DNS instead of IP.

---

## ğŸ§  Summary Recap

| Step | Description                             |
| ---- | --------------------------------------- |
| 1    | Build Node.js app                       |
| 2    | Dockerize it                            |
| 3    | Push image to ECR                       |
| 4    | Create ECS cluster                      |
| 5    | Define Task + Service                   |
| 6    | Deploy + access via IP or Load Balancer |

---


