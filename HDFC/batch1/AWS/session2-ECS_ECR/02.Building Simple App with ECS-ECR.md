
## 🧩 Building & Deploying Containers with **ECR + ECS**

**Goal:** Deploy a simple Node.js backend to AWS ECS using a container image stored in ECR.
**Duration:** ~2 hours (demo + explanation)

---

## 🔹 1. Recap — Containers & Docker

Before starting, quickly revisit these:

* **Containers** package code + dependencies → run identically everywhere.
* **Docker** is the most popular containerization tool.
* You write a `Dockerfile` → build image → run container.
* **ECR** (Elastic Container Registry): AWS’s private Docker image store.
* **ECS** (Elastic Container Service): AWS’s container orchestration service to run and scale containers.

---

## 🔹 2. Create a Simple Node.js Backend App

### 📁 Folder: `aws-node-demo`

```bash
mkdir aws-node-demo
cd aws-node-demo
npm init -y
npm install express
```

### 📄 server.js

```js
const express = require("express");
const app = express();
const PORT = process.env.PORT || 3000;

app.get("/", (req, res) => {
  res.send("🚀 Hello from AWS ECS!");
});

app.listen(PORT, () => console.log(`Server running on port ${PORT}`));
```

Test locally:

```bash
node server.js
# visit http://localhost:3000
```

---

## 🔹 3. Create a Dockerfile

### 📄 Dockerfile

```Dockerfile
# Step 1: Base image
FROM node:18-alpine

# Step 2: Set working directory
WORKDIR /app

# Step 3: Copy package.json and install deps
COPY package*.json ./
RUN npm install --production

# Step 4: Copy rest of app
COPY . .

# Step 5: Expose port and start app
EXPOSE 3000
CMD ["node", "server.js"]
```

Build and test locally:

```bash
docker build -t node-aws-demo .
docker run -p 3000:3000 node-aws-demo
```

✅ Test: visit [http://localhost:3000](http://localhost:3000) — you should see the message.

---

## 🔹 4. Push Image to **Amazon ECR**

### 🧭 Step-by-step (AWS Console + CLI)

1. **Login to AWS Console** → open **ECR**.

2. Click **Create Repository**

   * Name: `node-aws-demo`
   * Visibility: *Private*
   * Create.

3. Once created → click repository → click **View push commands** (top-right).

4. Follow those exact commands (AWS gives them customized for your region):

```bash
# 1. Authenticate Docker to AWS
aws ecr get-login-password --region ap-south-1 | docker login --username AWS --password-stdin <your-account-id>.dkr.ecr.ap-south-1.amazonaws.com

# 2. Tag your local image
docker tag node-aws-demo:latest <your-account-id>.dkr.ecr.ap-south-1.amazonaws.com/node-aws-demo:latest

# 3. Push to ECR
docker push <your-account-id>.dkr.ecr.ap-south-1.amazonaws.com/node-aws-demo:latest
```

✅ Verify in AWS Console → ECR → your image should appear under *Tags*.

---

## 🔹 5. Understanding ECS

**ECS** = Elastic Container Service → runs your containers in the cloud.

Key components:

| Concept             | Description                                                            |
| ------------------- | ---------------------------------------------------------------------- |
| **Cluster**         | Group of resources (EC2 or Fargate) where tasks run                    |
| **Task Definition** | Blueprint of container (image, CPU, memory, ports, env vars)           |
| **Service**         | Ensures that tasks (containers) keep running, can scale, restart, etc. |

---

## 🔹 6. Create ECS Cluster

### Option A: Fargate (Serverless, Recommended)

No EC2 management needed — AWS handles servers for you.

1. Go to **ECS → Clusters → Create Cluster**

   * Choose: **Networking only (Fargate)**
   * Name: `node-demo-cluster`
   * Create.

---

## 🔹 7. Create Task Definition

1. Go to **ECS → Task Definitions → Create new Task Definition**

   * Launch type: **Fargate**
   * Task name: `node-demo-task`
   * OS: Linux
   * CPU: 256
   * Memory: 512

2. Add container:

   * Name: `node-container`
   * Image: `<your-account-id>.dkr.ecr.ap-south-1.amazonaws.com/node-aws-demo:latest`
   * Port mappings: **3000**
   * Click “Add”.

3. Click **Create**.

---

## 🔹 8. Create Service (to run the container)

1. Go to **ECS → Clusters → node-demo-cluster → Services → Create**

   * Launch type: Fargate
   * Task Definition: `node-demo-task`
   * Service name: `node-demo-service`
   * Desired tasks: 1

2. Networking:

   * Choose **default VPC**
   * Choose **public subnets**
   * Assign **public IP = ENABLED**
   * Create new security group → allow **Inbound HTTP (port 3000)**

3. Click **Create Service** → wait until service status is *Running*.

---

## 🔹 9. Verify Deployment

1. Go to **Tasks → Running task → Network tab**
   Copy the **Public IP**.

2. Visit in browser:

```
http://<public-ip>:3000
```

✅ You should see “🚀 Hello from AWS ECS!”

---

## 🔹 10. (Optional) Expose via Load Balancer

If you want a production-grade setup:

* In ECS service creation step, choose “Application Load Balancer”.
* Create new ALB → target group → register ECS tasks.
* Access app via ALB DNS instead of IP.

---

## 🧠 Summary Recap

| Step | Description                             |
| ---- | --------------------------------------- |
| 1    | Build Node.js app                       |
| 2    | Dockerize it                            |
| 3    | Push image to ECR                       |
| 4    | Create ECS cluster                      |
| 5    | Define Task + Service                   |
| 6    | Deploy + access via IP or Load Balancer |

---


